"Voter Population Density (Logged)",
"State Unemployment Rate  (Logged)",
"State legislature control - DEM",
"State legislature control - REP",
"Vote Closeness of Candidates (Logged)",
"Prev. General Election VEP Turnout Rate (Logged)"
)
f.reg.multi.iv(dv.sav = dv,
iv.sav = iv,
ctrl.sav = ctrl,
dataframe.sav = p.df,
title.sav = "Voting Eligible Population (VEP) Turnout Rate (Logged)",
effect.sav = "twoways",
type.sav = "within",
# dv_label.sav = dv_label, cov_label.sav = cov_label,
# star.type = "html",
# star.out = paste0("05. Visualizations/", today(), "-regression-tbl-did.html"),
# star.type = "latex",
# star.out = paste0("05. Visualizations/", today(), "-regression-tbl-did.tex"),
out.sav = F)
# outputs <- list()
#
# outputs <- f.reg.multi.iv(dv.sav = dv,
#                iv.sav = iv,
#                ctrl.sav = ctrl,
#                dataframe.sav = p.df,
#                title.sav = "testingasdf",
#                effect.sav = "twoways",
#                type.sav = "within",
#                dv_label.sav = NULL, cov_label.sav = NULL,
#                star.type = ifelse(knitr::is_latex_output(),"latex", "text"),
#                star.out = NULL,
#                out.sav = T)
# out.df <- data.frame()
#
# for (i in 1:length(outputs)){
#   temp <- outputs[[i]] %>%
#     tidy() %>%
#     mutate(model = i)
#   out.df <- rbind(out.df, temp)
# }
# ggcoef(outputs[[4]],
#        conf.int = T,
#        conf.level = 0.90,
#        exclude_intercept = T
#        )
### Panel Data Frame for DID
p.df <- df %>%
filter(avg_DEMvote_perc > 0.0001 & avg_REPvote_perc > 0.0001) %>%
# filter(!redistrict_VAR_VAR == 0) %>%
# filter(!court_action_none_count_VAR == 1) %>%
# filter(year_num >= 2004 & year_num <= 2016) %>%
mutate(time = case_when(year %in% c("2000", "2004", "2008") ~ 0,
year %in% c("2012", "2016", "2020") ~ 1)) %>%
mutate(stateparty_control = fct_relevel(stateparty_control, "SPLIT", "DEM", "REP")) %>%
mutate(interaction_judiciary = time * judiciary_VAR,
interaction_court_action_none_count = time * court_action_none_count_VAR,
interaction_court_map_drawn_count = time * court_map_drawn_count_VAR,
interaction_court_return_leg_count = time * court_return_leg_count_VAR,
interaction_court_challenge_rejected_count = time * court_challenge_rejected_count_VAR,
interaction_judiciary_unfair = time * judiciary_unfair_map_VAR,
interaction_judiciary_fair = time * judiciary_fair_map_VAR
) %>%
pdata.frame(index = c("state_abv", "year"))
dv <- "log(vep_turnout_rate)"
iv <- c("interaction_court_action_none_count", "interaction_judiciary",  "interaction_judiciary_unfair", "interaction_judiciary_fair")
ctrl <- "log(vep_density) + log(state_unemploymentRate) + stateparty_control + log(lagged_vep) + log(vote_closeness)"
dv_label <- c("Model A", "Model B", "Model C", "Model D")
cov_label <- c("Interaction (NO Court Involvement X Time)",
"Interaction (ANY Court Involvement X Time)",
"Interaction (Court Finding: UNCONSTITUTIONAL Map X Time)",
"Interaction (Court Finding: CONSTITUTIONAL Map X Time)",
"Voter Population Density (Logged)",
"State Unemployment Rate  (Logged)",
"State legislature control - DEM",
"State legislature control - REP",
"Vote Closeness of Candidates (Logged)",
"Prev. General Election VEP Turnout Rate (Logged)"
)
f.reg.multi.iv(dv.sav = dv,
iv.sav = iv,
ctrl.sav = ctrl,
dataframe.sav = p.df,
title.sav = "Voting Eligible Population (VEP) Turnout Rate (Logged)",
effect.sav = "twoways",
type.sav = "within",
# dv_label.sav = dv_label, cov_label.sav = cov_label,
# star.type = "html",
# star.out = paste0("05. Visualizations/", today(), "-regression-tbl-did.html"),
# star.type = "latex",
# star.out = paste0("05. Visualizations/", today(), "-regression-tbl-did.tex"),
out.sav = F)
# outputs <- list()
#
# outputs <- f.reg.multi.iv(dv.sav = dv,
#                iv.sav = iv,
#                ctrl.sav = ctrl,
#                dataframe.sav = p.df,
#                title.sav = "testingasdf",
#                effect.sav = "twoways",
#                type.sav = "within",
#                dv_label.sav = NULL, cov_label.sav = NULL,
#                star.type = ifelse(knitr::is_latex_output(),"latex", "text"),
#                star.out = NULL,
#                out.sav = T)
# out.df <- data.frame()
#
# for (i in 1:length(outputs)){
#   temp <- outputs[[i]] %>%
#     tidy() %>%
#     mutate(model = i)
#   out.df <- rbind(out.df, temp)
# }
# ggcoef(outputs[[4]],
#        conf.int = T,
#        conf.level = 0.90,
#        exclude_intercept = T
#        )
### Panel Data Frame for DID
p.df <- df %>%
filter(avg_DEMvote_perc > 0.0001 & avg_REPvote_perc > 0.0001) %>%
mutate(time = case_when(year %in% c("2000", "2004", "2008") ~ 0,
year %in% c("2012", "2016", "2020") ~ 1)) %>%
mutate(stateparty_control = fct_relevel(stateparty_control, "SPLIT", "DEM", "REP")) %>%
mutate(interaction_judiciary = time * judiciary_VAR,
interaction_court_action_none_count = time * court_action_none_count_VAR,
interaction_court_map_drawn_count = time * court_map_drawn_count_VAR,
interaction_court_return_leg_count = time * court_return_leg_count_VAR,
interaction_court_challenge_rejected_count = time * court_challenge_rejected_count_VAR,
interaction_judiciary_unfair = time * judiciary_unfair_map_VAR,
interaction_judiciary_fair = time * judiciary_fair_map_VAR,
interaction_redistrict = time * redistrict_VAR_VAR
) %>%
pdata.frame(index = c("state_abv", "year"))
dv <- "log(vep_turnout_rate)"
iv <- c("interaction_redistrict")
ctrl <- "log(vep_density) + log(state_unemploymentRate) + stateparty_control + log(lagged_vep) + log(vote_closeness)"
f.reg.multi.iv(dv.sav = dv,
iv.sav = iv,
ctrl.sav = ctrl,
dataframe.sav = p.df,
title.sav = "Voting Eligible Population (VEP) Turnout Rate (Logged)",
effect.sav = "twoways",
type.sav = "within",
# dv_label.sav = dv_label, cov_label.sav = cov_label,
# star.type = "html",
# star.out = paste0("05. Visualizations/", today(), "-regression-tbl-did.html"),
# star.type = "latex",
# star.out = paste0("05. Visualizations/", today(), "-regression-tbl-did.tex"),
out.sav = F)
dv <- "log(vep_turnout_rate)"
iv <- c("interaction_court_action_none_count", "interaction_judiciary",  "interaction_judiciary_unfair", "interaction_judiciary_fair")
ctrl <- "log(vep_density) + log(state_unemploymentRate) + stateparty_control + log(lagged_vep) + log(vote_closeness) + redistrict_VAR_VAR"
dv_label <- c("Model A", "Model B", "Model C", "Model D")
cov_label <- c("Interaction (NO Court Involvement X Time)",
"Interaction (ANY Court Involvement X Time)",
"Interaction (Court Finding: UNCONSTITUTIONAL Map X Time)",
"Interaction (Court Finding: CONSTITUTIONAL Map X Time)",
"Voter Population Density (Logged)",
"State Unemployment Rate  (Logged)",
"State legislature control - DEM",
"State legislature control - REP",
"Vote Closeness of Candidates (Logged)",
"Prev. General Election VEP Turnout Rate (Logged)"
)
f.reg.multi.iv(dv.sav = dv,
iv.sav = iv,
ctrl.sav = ctrl,
dataframe.sav = p.df,
title.sav = "Voting Eligible Population (VEP) Turnout Rate (Logged)",
effect.sav = "twoways",
type.sav = "within",
# dv_label.sav = dv_label, cov_label.sav = cov_label,
# star.type = "html",
# star.out = paste0("05. Visualizations/", today(), "-regression-tbl-did.html"),
# star.type = "latex",
# star.out = paste0("05. Visualizations/", today(), "-regression-tbl-did.tex"),
out.sav = F)
# outputs <- list()
#
# outputs <- f.reg.multi.iv(dv.sav = dv,
#                iv.sav = iv,
#                ctrl.sav = ctrl,
#                dataframe.sav = p.df,
#                title.sav = "testingasdf",
#                effect.sav = "twoways",
#                type.sav = "within",
#                dv_label.sav = NULL, cov_label.sav = NULL,
#                star.type = ifelse(knitr::is_latex_output(),"latex", "text"),
#                star.out = NULL,
#                out.sav = T)
# out.df <- data.frame()
#
# for (i in 1:length(outputs)){
#   temp <- outputs[[i]] %>%
#     tidy() %>%
#     mutate(model = i)
#   out.df <- rbind(out.df, temp)
# }
# ggcoef(outputs[[4]],
#        conf.int = T,
#        conf.level = 0.90,
#        exclude_intercept = T
#        )
dv <- "log(vep_turnout_rate)"
iv <- c("interaction_court_action_none_count", "interaction_judiciary",  "interaction_judiciary_unfair", "interaction_judiciary_fair")
ctrl <- "log(vep_density) + log(state_unemploymentRate) + stateparty_control + log(lagged_vep) + log(vote_closeness) + factor(redistrict_VAR_VAR)"
dv_label <- c("Model A", "Model B", "Model C", "Model D")
cov_label <- c("Interaction (NO Court Involvement X Time)",
"Interaction (ANY Court Involvement X Time)",
"Interaction (Court Finding: UNCONSTITUTIONAL Map X Time)",
"Interaction (Court Finding: CONSTITUTIONAL Map X Time)",
"Voter Population Density (Logged)",
"State Unemployment Rate  (Logged)",
"State legislature control - DEM",
"State legislature control - REP",
"Vote Closeness of Candidates (Logged)",
"Prev. General Election VEP Turnout Rate (Logged)"
)
f.reg.multi.iv(dv.sav = dv,
iv.sav = iv,
ctrl.sav = ctrl,
dataframe.sav = p.df,
title.sav = "Voting Eligible Population (VEP) Turnout Rate (Logged)",
effect.sav = "twoways",
type.sav = "within",
# dv_label.sav = dv_label, cov_label.sav = cov_label,
# star.type = "html",
# star.out = paste0("05. Visualizations/", today(), "-regression-tbl-did.html"),
# star.type = "latex",
# star.out = paste0("05. Visualizations/", today(), "-regression-tbl-did.tex"),
out.sav = F)
# outputs <- list()
#
# outputs <- f.reg.multi.iv(dv.sav = dv,
#                iv.sav = iv,
#                ctrl.sav = ctrl,
#                dataframe.sav = p.df,
#                title.sav = "testingasdf",
#                effect.sav = "twoways",
#                type.sav = "within",
#                dv_label.sav = NULL, cov_label.sav = NULL,
#                star.type = ifelse(knitr::is_latex_output(),"latex", "text"),
#                star.out = NULL,
#                out.sav = T)
# out.df <- data.frame()
#
# for (i in 1:length(outputs)){
#   temp <- outputs[[i]] %>%
#     tidy() %>%
#     mutate(model = i)
#   out.df <- rbind(out.df, temp)
# }
# ggcoef(outputs[[4]],
#        conf.int = T,
#        conf.level = 0.90,
#        exclude_intercept = T
#        )
dv <- "log(vep_turnout_rate)"
iv <- c("interaction_court_action_none_count", "interaction_judiciary",  "interaction_judiciary_unfair", "interaction_judiciary_fair")
ctrl <- "log(vep_density) + log(state_unemploymentRate) + stateparty_control + log(lagged_vep) + log(vote_closeness)"
dv_label <- c("Model A", "Model B", "Model C", "Model D")
cov_label <- c("Interaction (NO Court Involvement X Time)",
"Interaction (ANY Court Involvement X Time)",
"Interaction (Court Finding: UNCONSTITUTIONAL Map X Time)",
"Interaction (Court Finding: CONSTITUTIONAL Map X Time)",
"Voter Population Density (Logged)",
"State Unemployment Rate  (Logged)",
"State legislature control - DEM",
"State legislature control - REP",
"Vote Closeness of Candidates (Logged)",
"Prev. General Election VEP Turnout Rate (Logged)"
)
f.reg.multi.iv(dv.sav = dv,
iv.sav = iv,
ctrl.sav = ctrl,
dataframe.sav = p.df,
title.sav = "Voting Eligible Population (VEP) Turnout Rate (Logged)",
effect.sav = "twoways",
type.sav = "within",
# dv_label.sav = dv_label, cov_label.sav = cov_label,
# star.type = "html",
# star.out = paste0("05. Visualizations/", today(), "-regression-tbl-did.html"),
# star.type = "latex",
# star.out = paste0("05. Visualizations/", today(), "-regression-tbl-did.tex"),
out.sav = F)
# outputs <- list()
#
# outputs <- f.reg.multi.iv(dv.sav = dv,
#                iv.sav = iv,
#                ctrl.sav = ctrl,
#                dataframe.sav = p.df,
#                title.sav = "testingasdf",
#                effect.sav = "twoways",
#                type.sav = "within",
#                dv_label.sav = NULL, cov_label.sav = NULL,
#                star.type = ifelse(knitr::is_latex_output(),"latex", "text"),
#                star.out = NULL,
#                out.sav = T)
# out.df <- data.frame()
#
# for (i in 1:length(outputs)){
#   temp <- outputs[[i]] %>%
#     tidy() %>%
#     mutate(model = i)
#   out.df <- rbind(out.df, temp)
# }
# ggcoef(outputs[[4]],
#        conf.int = T,
#        conf.level = 0.90,
#        exclude_intercept = T
#        )
dv <- "log(vep_turnout_rate)"
iv <- c("interaction_court_action_none_count", "interaction_judiciary",  "interaction_judiciary_unfair", "interaction_judiciary_fair")
ctrl <- "log(vep_density) + log(state_unemploymentRate) + stateparty_control + log(lagged_vep) + log(vote_closeness)"
dv_label <- c("Model A", "Model B", "Model C", "Model D")
cov_label <- c("Interaction (NO Court Involvement X Time)",
"Interaction (ANY Court Involvement X Time)",
"Interaction (Court Finding: UNCONSTITUTIONAL Map X Time)",
"Interaction (Court Finding: CONSTITUTIONAL Map X Time)",
"Voter Population Density (Logged)",
"State Unemployment Rate  (Logged)",
"State legislature control - DEM",
"State legislature control - REP",
"Vote Closeness of Candidates (Logged)",
"Prev. General Election VEP Turnout Rate (Logged)"
)
f.reg.multi.iv(dv.sav = dv,
iv.sav = iv,
ctrl.sav = ctrl,
dataframe.sav = p.df,
title.sav = "Voting Eligible Population (VEP) Turnout Rate (Logged)",
effect.sav = "twoways",
type.sav = "within",
dv_label.sav = dv_label, cov_label.sav = cov_label,
star.type = "html",
star.out = paste0("05. Visualizations/", today(), "-regression-tbl-did.html"),
out.sav = F)
# outputs <- list()
#
# outputs <- f.reg.multi.iv(dv.sav = dv,
#                iv.sav = iv,
#                ctrl.sav = ctrl,
#                dataframe.sav = p.df,
#                title.sav = "testingasdf",
#                effect.sav = "twoways",
#                type.sav = "within",
#                dv_label.sav = NULL, cov_label.sav = NULL,
#                star.type = ifelse(knitr::is_latex_output(),"latex", "text"),
#                star.out = NULL,
#                out.sav = T)
# out.df <- data.frame()
#
# for (i in 1:length(outputs)){
#   temp <- outputs[[i]] %>%
#     tidy() %>%
#     mutate(model = i)
#   out.df <- rbind(out.df, temp)
# }
# ggcoef(outputs[[4]],
#        conf.int = T,
#        conf.level = 0.90,
#        exclude_intercept = T
#        )
### Creating a function to run multiple regressions simultaneously
f.reg.multi <- function(dv.sav = dv,
iv.sav = iv,
dataframe.sav = p.df,
title.sav = "testingasdf",
effect.sav = "time",
type.sav = "within",
dv_label.sav = NULL,
cov_label.sav = NULL,
index.sav = NULL,
star.type = ifelse(knitr::is_latex_output(),"latex", "text"),
star.out = NULL) {
templist <- list()
for (i in 1:length(dv.sav)){
val <- dv.sav[[i]]
formula_str <- paste0(val, "~", iv.sav)
templist[[i]] <- plm(as.formula(paste(formula_str, collapse = " ")),
data = dataframe.sav
, effect = effect.sav,
model = type.sav
, index = index.sav
)
}
stargazer(templist,
type = star.type,
out = star.out,
report = "vc*sp",
title = "asdf",
dep.var.labels = paste0(title.sav),
dep.var.labels.include = T,
# column.sep.width = "0pt",
float = FALSE,
header = FALSE,
# no.space = TRUE,
font.size = "small",
column.labels = dv_label.sav,
covariate.labels = cov_label.sav
) %>%
return()
}
f.reg.multi.iv <- function(dv.sav = dv,
iv.sav = iv,
ctrl.sav = ctrl,
dataframe.sav = p.df,
title.sav = "testingasdf",
effect.sav = "time",
type.sav = "within",
dv_label.sav = NULL,
cov_label.sav = NULL,
index.sav = NULL,
star.type = ifelse(knitr::is_latex_output(),"latex", "text"),
star.out = NULL,
out.sav = boolean()) {
templist <- list()
for (i in 1:length(iv.sav)){
val <- iv.sav[[i]]
formula_str <- paste0(dv.sav, "~", val, "+", ctrl.sav)
templist[[i]] <- plm(as.formula(paste(formula_str, collapse = " ")),
data = dataframe.sav
, effect = effect.sav,
model = type.sav
, index = index.sav
)
}
if (out.sav == T) {
return(templist)
}
stargazer(templist,
type = star.type,
out = star.out,
report = "vc*sp",
title = "asdf",
dep.var.labels = paste0(title.sav),
dep.var.labels.include = T,
column.sep.width = "0pt",
float = FALSE,
header = FALSE,
no.space = TRUE,
font.size = "small",
column.labels = dv_label.sav,
covariate.labels = cov_label.sav,
model.numbers = F
) %>%
return()
}
dv <- "log(vep_turnout_rate)"
iv <- c("interaction_court_action_none_count", "interaction_judiciary",  "interaction_judiciary_unfair", "interaction_judiciary_fair")
ctrl <- "log(vep_density) + log(state_unemploymentRate) + stateparty_control + log(lagged_vep) + log(vote_closeness)"
dv_label <- c("Model A", "Model B", "Model C", "Model D")
cov_label <- c("Interaction (NO Court Involvement X Time)",
"Interaction (ANY Court Involvement X Time)",
"Interaction (Court Finding: UNCONSTITUTIONAL Map X Time)",
"Interaction (Court Finding: CONSTITUTIONAL Map X Time)",
"Voter Population Density (Logged)",
"State Unemployment Rate  (Logged)",
"State legislature control - DEM",
"State legislature control - REP",
"Vote Closeness of Candidates (Logged)",
"Prev. General Election VEP Turnout Rate (Logged)"
)
f.reg.multi.iv(dv.sav = dv,
iv.sav = iv,
ctrl.sav = ctrl,
dataframe.sav = p.df,
title.sav = "Voting Eligible Population (VEP) Turnout Rate (Logged)",
effect.sav = "twoways",
type.sav = "within",
dv_label.sav = dv_label, cov_label.sav = cov_label,
star.type = "html",
star.out = paste0("05. Visualizations/", today(), "-regression-tbl-did.html"),
out.sav = F)
# outputs <- list()
#
# outputs <- f.reg.multi.iv(dv.sav = dv,
#                iv.sav = iv,
#                ctrl.sav = ctrl,
#                dataframe.sav = p.df,
#                title.sav = "testingasdf",
#                effect.sav = "twoways",
#                type.sav = "within",
#                dv_label.sav = NULL, cov_label.sav = NULL,
#                star.type = ifelse(knitr::is_latex_output(),"latex", "text"),
#                star.out = NULL,
#                out.sav = T)
# out.df <- data.frame()
#
# for (i in 1:length(outputs)){
#   temp <- outputs[[i]] %>%
#     tidy() %>%
#     mutate(model = i)
#   out.df <- rbind(out.df, temp)
# }
# ggcoef(outputs[[4]],
#        conf.int = T,
#        conf.level = 0.90,
#        exclude_intercept = T
#        )
ggplot(t_test_results, aes(x = as.numeric(year), y = diff)) +
geom_point() +
geom_vline(xintercept = 2010, linetype = 2, alpha = 0.4) +
geom_hline(yintercept = 0, linetype = 1, alpha = 0.7, colour = "red") +
geom_line() +
geom_errorbar(aes(ymin = cimin, ymax = cimax), width = 0.2) +
scale_y_continuous(limits = c(-2, 2), breaks = c(-1,0,1))+
#scale_x_discrete(limits = c(-5,-4,-3,-2,-1,0,1,2,3,4,5)) +
labs(x = "Year", y = "Difference in Means (Turnout Rate)",
title = "Redistriction : T-Test Difference in Means") +
theme_minimal()
